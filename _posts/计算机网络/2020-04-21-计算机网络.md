---
layout: post
title: 计算机网络
category: 计算机网络
tags: 计算机网络
keywords: 计算机网络
---
## OSI7层
1. 物理层
    * 传输比特流
2. 数据链路层
    * 将比特数据转换为帧
3. 网络层
4. 传输层
5. 会话层
6. 表示层
7. 应用层

## TCP/IP
1. 链路层
2. 网络层
3. 传输层
4. 应用层

## TCP的三次握手
"握手"是为了建立连接
三次握手是为了初始化Sequence Number的初始值
1. 第一次握手:建立连接时,客户端发送SYN包[syn=j]到服务器,并进入SYN_SEND状态,等待服务器确认
2. 第二次握手:服务器收到SYN包,必须确认客户的SYN(ack=j+1),同时自己也发送一个SYN包(syn=k),即SYN+ACK包,此时服务器进入SYN_RECV状态
3. 第三次握手:客户端收到服务器的SYN+ACK包,向服务器发送确认包ACK(ack=k+1),此包发送完毕,客户端和服务端进入ESTABLISHED状态,完成三次握手
4. 首次握手的隐患(SYN超时)
    * server收到client的SYN,回复SYN-ACK的时候未收到ACK确认
    * server不断重试直至超时,linux默认等待63秒才断开连接
    * 针对SYN Flood的防护措施
        * SYN队列满后,通过tcp_syncookies参数回发SYN Cookie
        * 若为正常连接则Client会回发SYN Cookie,直接建立连接
5. 保活机制
    * 向对方发送保活探测报文,如果未收到响应则继续发送

* 传输控制协议TCP：
    * 面向连接的、可靠的、基于字节流的传输层通信协议
    * 将应用层的数据流分割成报文段并发送给目标节点的TCP层
    * 数据包都有序号,对方收到则发送ACK确认，未收到则重传
    * 使用校验和来检验数据在传输过程中是否有误
* TCP报文头
    * TCP Flags
        * URG:紧急指针标志(1有效,0忽略)
        * ACK:确认序号标志
        * PSH:push标志(是否交给应用程序,而不是排队)
        * RST:重置连接标志
        * SYN:同步序号,用于建立连接过程
        * FIN:finish标志,用于释放连接

## TCP的四次挥手
"挥手"是为了终止连接   
因为全双工,发送方和接收方都需要FIN报文和ACK报文,所以要四次
1. 第一次挥手:Client发送一个FIN,用来关闭Client到Server的数据传送,Client进入FIN_WAIT_1状态
2. 第二次挥手:Server收到FIN后,发送一个ACK给Client,确认序号为收到序号加1(与SYN相同,一个FIN占用一个序号),Server进入CLOSE_WAIT状态
3. 第三次挥手:Server发送一个FIN,用来关闭Server到Client的数据传送,Server进入LAST_ACK状态
4. 第四次挥手:Client收到FIN后,Client进入TIME_WAIT状态,接着发送一个ACK给Server,确认序号为收到序号加1,Server进入CLOSED状态,完成四次挥手
5. TIME_WAIT状态
    * 确保有足够时间让对方收到ACK包
    * 避免新旧连接混淆   

* 服务器大量CLOSE_WAIT状态的原因
    * 对方关闭socket连接,我方忙于读或写,没有及时关闭连接
        * 检查代码,特别是释放资源的代码
        * 检查配置,特别是处理请求的线程配置   

## TCP的滑动窗口
TCP使用滑动窗口做流量控制与乱序重排:
1. 保证TCP的可靠性
2. 保证TCP的流控性   

* RTT:发送一个数据包到收到对应的ACK所花费的时间
* RTO:重传时间间隔

## UDP
* 特点
    * 面向非连接
    * 不维护连接状态,支持同时向多个客户端传输相同的消息
    * 数据包报头只有8个字节,额外开销较小
    * 吞吐量只受限与数据生成速率、传输速率以及机器性能
    * 尽最大努力交付,不保证可靠交付,不需要维持复杂的连接状态表
    * 面向报文,不对应用程序提交的报文信息进行拆分或者合并
* TCP和UDP的区别
    * 面向连接vs无连接
    * 可靠性
    * 有序性
    * 速度
    * 量级

## HTTP
* 支持客户/服务器模式
* 简单快速
* 灵活
* 无连接
* 无状态
* 请求/响应步骤
    * 客户端连接到Web服务器
    * 发送HTTP请求
    * 服务器接收请求并返回HTTP响应
    * 释放连接TCP
    * 客户端浏览器解析HTML内容
* 在浏览器地址栏键入URL,按下回车之后经历的流程
    * DNS解析(浏览器缓存->系统缓存->路由器缓存->IPS服务器缓存->根域名服务器缓存->顶级域名服务器缓存)
    * TCP连接
    * 发送HTTP请求
    * 服务器处理请求并返回HTTP报文
    * 浏览器解析渲染页面
    * 连接结束
* HTTP状态码
    * 1XX:指示信息--表示请求已接收,继续处理
    * 2XX:成功--表示请求已成功接收、理解、接受
    * 3XX:重定向--要完成请求必须进行更进一步的操作
    * 4XX:客户端错误--请求有语法错误或请求无法实现
    * 5XX:服务器错误--服务器未能实现合法请求
    * 常见状态码:
        * 200 OK:正常返回信息
        * 400 Bad Request:客户端请求有语法错误,不能被服务器理解
        * 401 Unauthorized:请求未经授权,这个状态码必须和WWW-Authenticate报头域一起使用
        * 403 Forbidden:服务器收到请求,但是拒绝提供服务
        * 404 Not Found:请求资源不存在
        * 500 Internal Server Error:服务器发生不可预期的错误
        * 503 Server Unavailable:服务器当前不能处理客户端请求,一段时间后可能恢复正常   
* GET请求和POST请求的区别
    * Http报文层面:GET将请求信息放在URL,POST放在报文体中
    * 数据库层面:GET符合幂等性和安全性,POST不符合
    * 其它层面:GET可以被缓存、被存储,而POST不行
* Cookie和Session的区别
    * Cookie
        * 以键值对的形式存储在浏览器，大小不超过4kb
        * cookie不能跨域，当前及其父级域名可以取值
        * cookie可以设置有效期
        * cookie可以设置path
        * 是由服务器给客户端的特殊信息,以文本的形式存放在客户端
        * 客户端再次请求的时候,会把Cookie回发
        * 服务器接收到后,会解析Cookie生成与客户端相对应的内容
    * Session
        * 基于服务器内存的缓存(非持久化)，可保存请求会话
        * 每个session通过session id来区分不同的请求
        * session可设置过期时间
        * session也是以键值对形式存在的
        * 服务器端的机制,在服务器上保存信息
        * 解析客户端请求并操作session id,按需要保存状态信息
        * session的实现方式(1.使用Cookie来实现;2.使用URL回写来实现)
    * 区别
        * Cookie数据存放在客户的浏览器上,Session数据放在服务器上
        * Session相对于Cookie更安全
        * 若考虑到减轻服务器负担,应当使用Cookie   

## HTTP和HTTPS的区别
SSL(Security Sockets Layer,安全套接层)
* 为网络通信提供安安全及数据完整性的一种安全协议
* 是操作系统对外的API,SSL3.0后更名为TLS
* 采用身份验证和数据加密保证网络通信的安全和数据的完整性   

加密的方式
* 对称加密:加密和解密都使用同一个密钥
* 非对称加密:加密使用的密钥和解密使用的密钥是不同的
* 哈希算法:将任意长度的信息转换为固定长度的值,算法不可逆
* 数字签名:证明某个消息或者文件是某人发出/认同的   

HTTPS数据传输流程
* 浏览器将支持的加密算法信息发送给服务器
* 服务器选择一套浏览器支持的加密算法,以证书的形式回发浏览器
* 浏览器验证证书合法性,并结合证书公钥加密信息发送给服务器
* 服务器使用私钥解密信息,验证哈希,加密响应消息回发给浏览器
* 客户端解密响应消息,并对消息进行验真,之后进行加密交互数据   

HTTP和HTTPS的区别
* HTTPS需要到CA申请证书,HTTP不需要
* HTTPS密文传输,HTTP明文传输
* 连接方式不同,HTTPS默认使用443端口,HTTP使用80端口
* HTTPS=HTTP+加密+认证+完整性保护,较HTTP安全   

补充
* 浏览器默认填充http://
* 可以是使用HSTS优化   

## Socket
Socket是对TCP/IP协议的抽象,是操作系统对外开放的接口
